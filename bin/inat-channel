#!/usr/bin/ruby
require_relative '../lib/inat-channel'
include IC

logger.info "=== iNatChannel Run ==="

news = load_news
logger.info "Found #{news.size} fresh UUIDs (days_back=#{CONFIG[:days_back]})"

uuid = select_uuid news

if uuid
  obs = load_observation(uuid)
  if obs
    send_observation(obs)
  else
    logger.warn "Failed to load #{uuid} — returning to pool"
    pool << uuid 
    notify_admin "Failed to load #{uuid} — returning to pool"
  end

  save_data
else
  notify_admin 'No observation to send.'
  logger.warn 'No observation to send.'
end

